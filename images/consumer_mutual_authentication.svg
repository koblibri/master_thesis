<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1447px" preserveAspectRatio="none" style="width:974px;height:1447px;background:#FFFFFF;" version="1.1" viewBox="0 0 974 1447" width="974px" zoomAndPan="magnify"><defs/><g><rect height="292.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="890" x="78" y="110.5625"/><rect height="183.8672" style="stroke:#000000;stroke-width:1.5;fill:none;" width="870" x="88" y="212.0938"/><rect height="681.6563" style="stroke:#000000;stroke-width:1.5;fill:none;" width="829" x="78" y="649.6875"/><rect height="187.8672" style="stroke:#000000;stroke-width:1.5;fill:none;" width="809" x="88" y="921.1484"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="118" x2="118" y1="36.2969" y2="1411.7422"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="642.5" x2="642.5" y1="36.2969" y2="1411.7422"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="98" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="105" y="24.9951">LPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="98" y="1410.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="105" y="1430.7373">LPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="606.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="613.5" y="24.9951">SM-DP+</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="606.5" y="1410.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="613.5" y="1430.7373">SM-DP+</text><line style="stroke:#181818;stroke-width:1.0;" x1="118.5" x2="160.5" y1="82.5625" y2="82.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="160.5" y1="82.5625" y2="95.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="119.5" x2="160.5" y1="95.5625" y2="95.5625"/><polygon fill="#181818" points="129.5,91.5625,119.5,95.5625,129.5,99.5625,125.5,95.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="492" x="125.5" y="62.3638">Scan Activation Code containing SM-DP+ Address, AC Token (= Matching ID),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="125.5" y="77.4966">SM-DP+ OID.</text><path d="M78,110.5625 L342,110.5625 L342,117.6953 L332,127.6953 L78,127.6953 L78,110.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="292.3984" style="stroke:#000000;stroke-width:1.5;" width="890" x="78" y="110.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="219" x="93" y="123.6294">[ES9+]InitiateAuthentication</text><polygon fill="#181818" points="630.5,144.8281,640.5,148.8281,630.5,152.8281,634.5,148.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="118.5" x2="636.5" y1="148.8281" y2="148.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="125.5" y="143.7622">eUICC Challenge, eUICC Info1, smdpAddress</text><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="158" x="563" y="161.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="567" y="177.895">Check SM-DP+ Address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="567" y="193.0278">Verify eUICC Signature</text><path d="M88,212.0938 L154,212.0938 L154,219.2266 L144,229.2266 L88,229.2266 L88,212.0938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="183.8672" style="stroke:#000000;stroke-width:1.5;" width="870" x="88" y="212.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="103" y="225.1606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116" x="169" y="224.3042">[verification fail]</text><polygon fill="#181818" points="129.5,246.3594,119.5,250.3594,129.5,254.3594,125.5,250.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123.5" x2="641.5" y1="250.3594" y2="250.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="135.5" y="245.2935">[Execution Failed]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88" x2="958" y1="259.3594" y2="259.3594"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144" x="93" y="269.5698">[verification success]</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="611" x="337" y="278.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="341" y="294.231">Generate TransactionID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="341" y="309.3638">Generate serverChallenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="603" x="341" y="324.4966">Generate serverSigned1 {TransactionID, eUICCChallenge, serverChallenge, SM-DP+-Address}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="341" y="339.6294">Generate serverSignature1 over serverSigned1</text><polygon fill="#181818" points="129.5,383.9609,119.5,387.9609,129.5,391.9609,125.5,387.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="123.5" x2="641.5" y1="387.9609" y2="387.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="135.5" y="367.7622">TransactionID, serverChallenge, serverSigned1, serverSignature,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="135.5" y="382.895">CI-PubKey-ID, SM-DP+-Certificate</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="227" x="5" y="414.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="9" y="431.0278">Check SM-DP+ Address.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="9" y="446.1606">OID in Cert must match OID in AC.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="9" y="461.2935">Generate ctxParams1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="9" y="476.4263">Authenticate Server</text><rect fill="#FEFFDD" height="144" style="stroke:#181818;stroke-width:0.5;" width="268" x="123" y="493.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="127" y="509.5591">eUICCSigned1 contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="131" y="524.6919">- transactionID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="131" y="539.8247">- serverAddress</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="131" y="554.9575">- serverChallenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="131" y="570.0903">- euiccInfo2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="139" y="585.2231">- List of eUICC Capabilities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="131" y="600.356">- ctxParams1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="139" y="615.4888">- matchingID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="139" y="630.6216">- deviceInfo: List of Device Capabilities</text><path d="M78,649.6875 L316,649.6875 L316,656.8203 L306,666.8203 L78,666.8203 L78,649.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="681.6563" style="stroke:#000000;stroke-width:1.5;" width="829" x="78" y="649.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193" x="93" y="662.7544">[ES9+]AuthenticateClient</text><polygon fill="#181818" points="630.5,699.0859,640.5,703.0859,630.5,707.0859,634.5,703.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="118.5" x2="636.5" y1="703.0859" y2="703.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="496" x="125.5" y="682.8872">transactionID, authenticateServerResponse [eUICCSigned1, eUICCSignature1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="125.5" y="698.02">eUICC-Certificate, EUM-Certificate]</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="354" x="465" y="716.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="469" y="732.1528">Verify EUM-Certificate with CI-PK, extract EUM-PK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="469" y="747.2856">Verify eUICC-Certificate with EUM-PK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="469" y="762.4185">Verify eUICCSignature1 and eUICCSigned1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="469" y="777.5513">Attached TransactionID and serverChallenge matches</text><polygon fill="#181818" points="129.5,806.75,119.5,810.75,129.5,814.75,125.5,810.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123.5" x2="641.5" y1="810.75" y2="810.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="135.5" y="805.6841">[Execution failed]</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="408" x="438" y="823.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="442" y="839.8169">Maximum Download Attempts for profile Download exceeded</text><polygon fill="#181818" points="129.5,869.0156,119.5,873.0156,129.5,877.0156,125.5,873.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123.5" x2="641.5" y1="873.0156" y2="873.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="135.5" y="867.9497">[Execution failed]</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="373" x="456" y="886.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="460" y="902.0825">ctxParams1 contain ctxParamsForCommonAuthetication</text><path d="M88,921.1484 L154,921.1484 L154,928.2813 L144,938.2813 L88,938.2813 L88,921.1484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="187.8672" style="stroke:#000000;stroke-width:1.5;" width="809" x="88" y="921.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="103" y="934.2153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="357" x="169" y="933.3589">[Pending Profile download order associated with EID]</text><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="489" x="398" y="943.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="402" y="959.3481">ctxParams for CA contain MatchingID: Verification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="402" y="974.481">No MatchingID: Select any Profile Download order associated with this EID</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88" x2="897" y1="987.5469" y2="987.5469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="203" x="93" y="997.7573">[No PPDO associated with EID]</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="312" x="486" y="1006.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="490" y="1022.4185">ctxParams for CA contain MatchingID:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="494" y="1037.5513">- Check if there is a PPDO with this MatchingID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="494" y="1052.6841">- PPDO is not associated with any EID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="490" y="1067.8169">No MatchingID: Verification Fail</text><polygon fill="#181818" points="129.5,1097.0156,119.5,1101.0156,129.5,1105.0156,125.5,1101.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123.5" x2="641.5" y1="1101.0156" y2="1101.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="135.5" y="1095.9497">[Execution failed]</text><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="202" x="541" y="1121.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="545" y="1137.0825">Identify Profile for PPDO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="545" y="1152.2153">Profile has been released</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="545" y="1167.3481">Perform eUICC eligibility check</text><polygon fill="#181818" points="129.5,1196.5469,119.5,1200.5469,129.5,1204.5469,125.5,1200.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123.5" x2="641.5" y1="1200.5469" y2="1200.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="135.5" y="1195.481">[Execution Failed]</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="358" x="463" y="1213.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="467" y="1229.6138">Generate Profile Metatdata</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="467" y="1244.7466">Attach PK.EUICC.ECDSA to ongoing RSP session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="467" y="1259.8794">Does order require confirmation code?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="467" y="1275.0122">Generate smdpSigned2 data object &amp; smdpSignature2</text><polygon fill="#181818" points="129.5,1319.3438,119.5,1323.3438,129.5,1327.3438,125.5,1323.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="123.5" x2="641.5" y1="1323.3438" y2="1323.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="407" x="135.5" y="1303.145">transactionID, profileMetaData, smdpSigned2, smdpSignature2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="135.5" y="1318.2778">smdpCertificate</text><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="335" x="475" y="1343.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="479" y="1359.4106">Verify PPDO exists for MatchingID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327" x="479" y="1374.5435">If PPDO is already linked to EID, verify EID matches</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="479" y="1389.6763">PPDO is in "Released" or "Downloaded" State</text><!--MD5=[2c70193d8fa6b236e0c4407e57259e67]
@startuml
skinparam maxMessageSize 500
LPA -> LPA : Scan Activation Code containing SM-DP+ Address, AC Token (= Matching ID), SM-DP+ OID.
group [ES9+]InitiateAuthentication
 "SM-DP+" <- LPA : eUICC Challenge, eUICC Info1, smdpAddress
 rnote over "SM-DP+"
  Check SM-DP+ Address
  Verify eUICC Signature
 end rnote
 alt verification fail
  "SM-DP+" - -> LPA : [Execution Failed]
 else verification success
  rnote over "SM-DP+"
   Generate TransactionID
   Generate serverChallenge
   Generate serverSigned1 {TransactionID, eUICCChallenge, serverChallenge, SM-DP+-Address}
   Generate serverSignature1 over serverSigned1
  end rnote
 "SM-DP+"->LPA: TransactionID, serverChallenge, serverSigned1, serverSignature, CI-PubKey-ID, SM-DP+-Certificate
 end
end
rnote over LPA
 Check SM-DP+ Address. 
 OID in Cert must match OID in AC.
 Generate ctxParams1
 Authenticate Server
end rnote
rnote right LPA
eUICCSigned1 contains:
 - transactionID
 - serverAddress
 - serverChallenge
 - euiccInfo2
   - List of eUICC Capabilities
 - ctxParams1
   - matchingID
   - deviceInfo: List of Device Capabilities
end rnote
group [ES9+]AuthenticateClient
 LPA -> "SM-DP+" : transactionID, authenticateServerResponse [eUICCSigned1, eUICCSignature1, eUICC-Certificate, EUM-Certificate]

 rnote over "SM-DP+"
  Verify EUM-Certificate with CI-PK, extract EUM-PK
  Verify eUICC-Certificate with EUM-PK
  Verify eUICCSignature1 and eUICCSigned1
  Attached TransactionID and serverChallenge matches
 end rnote
  "SM-DP+" - -> LPA : [Execution failed]
 rnote over "SM-DP+"
  Maximum Download Attempts for profile Download exceeded 
 end rnote
  "SM-DP+" - -> LPA : [Execution failed]
  rnote over "SM-DP+": ctxParams1 contain ctxParamsForCommonAuthetication
  alt Pending Profile download order associated with EID
   rnote over "SM-DP+"
   ctxParams for CA contain MatchingID: Verification
   No MatchingID: Select any Profile Download order associated with this EID  
   end rnote
  else No PPDO associated with EID
   rnote over "SM-DP+"
    ctxParams for CA contain MatchingID: 
     - Check if there is a PPDO with this MatchingID 
     - PPDO is not associated with any EID
    No MatchingID: Verification Fail
   end rnote
   "SM-DP+" - -> LPA: [Execution failed]
 end
  rnote over "SM-DP+"
   Identify Profile for PPDO
   Profile has been released
   Perform eUICC eligibility check
  end rnote
  "SM-DP+" - -> LPA : [Execution Failed]
  rnote over "SM-DP+"
   Generate Profile Metatdata
   Attach PK.EUICC.ECDSA to ongoing RSP session
   Does order require confirmation code?
   Generate smdpSigned2 data object & smdpSignature2
  end rnote
"SM-DP+" -> LPA : transactionID, profileMetaData, smdpSigned2, smdpSignature2, smdpCertificate
end group
rnote over "SM-DP+"
Verify PPDO exists for MatchingID
If PPDO is already linked to EID, verify EID matches
PPDO is in "Released" or "Downloaded" State
end rnote
@enduml

PlantUML version 1.2022.6beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>