<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1553px" preserveAspectRatio="none" style="width:1266px;height:1553px;background:#FFFFFF;" version="1.1" viewBox="0 0 1266 1553" width="1266px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="176" x2="176" y1="36.2969" y2="1518.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="252" x2="252" y1="36.2969" y2="1518.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="670.5" x2="670.5" y1="36.2969" y2="1518.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1081" x2="1081" y1="36.2969" y2="1518.3984"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="138" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="145" y="24.9951">End User</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="138" y="1517.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="145" y="1537.3936">End User</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="224" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="231" y="24.9951">eUICC</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="224" y="1517.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="231" y="1537.3936">eUICC</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="650.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="657.5" y="24.9951">LPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="650.5" y="1517.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="657.5" y="1537.3936">LPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="1045" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1052" y="24.9951">SM-DP+</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="1045" y="1517.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1052" y="1537.3936">SM-DP+</text><polygon fill="#181818" points="659,78.5625,669,82.5625,659,86.5625,663,82.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176" x2="665" y1="82.5625" y2="82.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="183" y="62.3638">Scan Activation Code containing SM-DP+ Address, AC Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="183" y="77.4966">(= Matching ID)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1259" x="0" y="111.1289"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="111.1289" y2="111.1289"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="114.1289" y2="114.1289"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="190" x="534.5" y="100.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171" x="540.5" y="116.6294">Mutual Authentication</text><polygon fill="#181818" points="659,150.8281,669,154.8281,659,158.8281,663,154.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="252" x2="665" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="259" y="149.7622">eUICCInfo1</text><polygon fill="#181818" points="659,179.9609,669,183.9609,659,187.9609,663,183.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="252" x2="665" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="259" y="178.895">eUICC Challenge</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="461" x="645" y="196.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="379" x="686.25" y="213.0278">Establish HTTPS Connection in Server-Authentication Mode.</text><polygon fill="#181818" points="1069,242.2266,1079,246.2266,1069,250.2266,1073,246.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="671" x2="1075" y1="246.2266" y2="246.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="678" y="241.1606">eUICC Challenge, eUICC Info1, smdpAddress</text><rect fill="#FEFFDD" height="83" style="stroke:#181818;stroke-width:0.5;" width="176" x="993" y="259.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="997" y="275.2935">Check SM-DP+ Address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="997" y="290.4263">Verify eUICC Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="997" y="305.5591">Generate TransactionID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="997" y="320.6919">Generate serverChallenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="997" y="335.8247">Generate serverSigned1</text><polygon fill="#181818" points="682,380.1563,672,384.1563,682,388.1563,678,384.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="676" x2="1080" y1="384.1563" y2="384.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="688" y="363.9575">TransactionID, serverSigned1, serverSignature, SM-DP+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="688" y="379.0903">(DPauth) Certificate</text><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="397" x="472" y="397.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389" x="476" y="413.2231">Check returned SM-DP+ Address (contained in serverSigned)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="476" y="428.356">OID in Cert must match OID in AC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="476" y="443.4888">Generate ctxParams1 (M-ID, deviceInfo)</text><polygon fill="#181818" points="263,487.8203,253,491.8203,263,495.8203,259,491.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="257" x2="670" y1="491.8203" y2="491.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="269" y="471.6216">Authenticate Server (Transaction-ID, serverSigned1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="269" y="486.7544">ctxParams1)</text><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="494" x="5" y="504.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="9" y="520.8872">Verify SM-DP+ Certificate against CI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="9" y="536.02">Verify SM-DP+ signed1 &amp; Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="486" x="9" y="551.1528">Generate euiccSigned1 (Trans-ID, serverChallenge, euiccInfo2, ctxParams1)</text><polygon fill="#181818" points="659,580.3516,669,584.3516,659,588.3516,663,584.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="252" x2="665" y1="584.3516" y2="584.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="259" y="579.2856">eUICCSigned1, eUICC &amp; EUM Certificate</text><polygon fill="#181818" points="1069,609.4844,1079,613.4844,1069,617.4844,1073,613.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="671" x2="1075" y1="613.4844" y2="613.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="678" y="608.4185">Authenticate Client (eUICCSigned1, eUICC &amp; EUM Certificate)</text><rect fill="#FEFFDD" height="144" style="stroke:#181818;stroke-width:0.5;" width="346" x="908" y="626.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="912" y="642.5513">Verify eUICC &amp; EUM Certificate against CI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="912" y="657.6841">Verify eUICC signed1 &amp; Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="912" y="672.8169">Attached TransactionID &amp; Server-Challenge matches</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="912" y="687.9497">ctxParams1 M-ID matches a PPDO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="912" y="703.0825">PPDO is (not) associated with EID?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="912" y="718.2153">PPDO is "released" or "downloaded"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="912" y="733.3481">Perform eUICC eligibility check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="912" y="748.481">Build Profile Metadata</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="912" y="763.6138">smdpSigned2 (TransID, CC Required Flag)</text><polygon fill="#181818" points="682,807.9453,672,811.9453,682,815.9453,678,811.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="676" x2="1080" y1="811.9453" y2="811.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="363" x="688" y="791.7466">TransID, Profile Metadata, smdpSigned2, SM-DP+ (DPpb)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="688" y="806.8794">Certificate</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1259" x="0" y="840.5117"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="840.5117" y2="840.5117"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="843.5117" y2="843.5117"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="149" x="555" y="829.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="561" y="846.0122">Profile Download</text><line style="stroke:#181818;stroke-width:1.0;" x1="671" x2="713" y1="884.2109" y2="884.2109"/><line style="stroke:#181818;stroke-width:1.0;" x1="713" x2="713" y1="884.2109" y2="897.2109"/><line style="stroke:#181818;stroke-width:1.0;" x1="672" x2="713" y1="897.2109" y2="897.2109"/><polygon fill="#181818" points="682,893.2109,672,897.2109,682,901.2109,678,897.2109" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="678" y="879.145">PPR(s) allowed</text><polygon fill="#181818" points="659,922.3438,669,926.3438,659,930.3438,663,926.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176" x2="665" y1="926.3438" y2="926.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="183" y="921.2778">Profile Download Consent</text><polygon fill="#181818" points="659,951.4766,669,955.4766,659,959.4766,663,955.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176" x2="665" y1="955.4766" y2="955.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="183" y="950.4106">Enter Confirmation Code if required</text><polygon fill="#181818" points="263,995.7422,253,999.7422,263,1003.7422,259,999.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="257" x2="670" y1="999.7422" y2="999.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="269" y="979.5435">PrepareDownload (smdpSigned2, SM-DP+ (DPpb) Certificate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="269" y="994.6763">hashed CC)</text><rect fill="#FEFFDD" height="68" style="stroke:#181818;stroke-width:0.5;" width="399" x="52" y="1012.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="56" y="1028.8091">Verify DPpb Certificate, and if auth and pb have same owner</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="56" y="1043.9419">Verify signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="56" y="1059.0747">Generate ECKA one-time keypair</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="56" y="1074.2075">Generate eUICCSigned2 (Trans-ID, otPK-EUICC, HashedCC)</text><polygon fill="#181818" points="659,1103.4063,669,1107.4063,659,1111.4063,663,1107.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="252" x2="665" y1="1107.4063" y2="1107.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="259" y="1102.3403">euiccSigned2, euiccSignature2</text><polygon fill="#181818" points="1069,1132.5391,1079,1136.5391,1069,1140.5391,1073,1136.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="671" x2="1075" y1="1136.5391" y2="1136.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377" x="678" y="1131.4731">Get Bound Profile Package (euiccSigned2, euiccSignature2)</text><rect fill="#FEFFDD" height="98" style="stroke:#181818;stroke-width:0.5;" width="300" x="931" y="1149.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="935" y="1165.606">Verify Signature &amp; hashed Confirmation Code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="935" y="1180.7388">Generate ECKA one-time keypair</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="935" y="1195.8716">Generate Session Keys</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="935" y="1211.0044">Generate BPP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="935" y="1226.1372">Link BPP to EID if not already done</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="935" y="1241.27">Encrypt BPP with session keys</text><polygon fill="#181818" points="682,1270.4688,672,1274.4688,682,1278.4688,678,1274.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="676" x2="1080" y1="1274.4688" y2="1274.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="688" y="1269.4028">Trans-ID, BPP</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1259" x="0" y="1303.0352"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="1303.0352" y2="1303.0352"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1259" y1="1306.0352" y2="1306.0352"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="162" x="548.5" y="1292.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="143" x="554.5" y="1308.5356">Profile Installation</text><polygon fill="#181818" points="263,1342.7344,253,1346.7344,263,1350.7344,259,1346.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="257" x2="670" y1="1346.7344" y2="1346.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="269" y="1341.6685">Initialise Secure Channel</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="156" x="174" y="1359.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="178" y="1375.8013">Generate Session Keys</text><polygon fill="#181818" points="263,1405,253,1409,263,1413,259,1409" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="257" x2="670" y1="1409" y2="1409"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="269" y="1403.9341">Load Bound Profile Package x N</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="353" x="75" y="1422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="79" y="1438.0669">Rearrange Profile Package, Decrypt with session keys</text><polygon fill="#181818" points="659,1467.2656,669,1471.2656,659,1475.2656,663,1471.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="252" x2="665" y1="1471.2656" y2="1471.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="259" y="1466.1997">Profile Installation Result</text><polygon fill="#181818" points="1069,1496.3984,1079,1500.3984,1069,1504.3984,1073,1500.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="671" x2="1075" y1="1500.3984" y2="1500.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="678" y="1495.3325">Profile Installation Result Notification</text><!--MD5=[a4d1d891f402df620443a401d33a6528]
@startuml
skinparam maxMessageSize 400
participant eUICC order 10
participant LPA order 20
participant "SM-DP+" order 40
"End User" -> LPA : Scan Activation Code containing SM-DP+ Address, AC Token (= Matching ID)
== Mutual Authentication ==
eUICC -> LPA : eUICCInfo1
eUICC -> LPA : eUICC Challenge

rnote over LPA, "SM-DP+": Establish HTTPS Connection in Server-Authentication Mode.
LPA -> "SM-DP+": eUICC Challenge, eUICC Info1, smdpAddress
 rnote over "SM-DP+"
  Check SM-DP+ Address
  Verify eUICC Signature
  Generate TransactionID
  Generate serverChallenge
  Generate serverSigned1
 end rnote
LPA <- - "SM-DP+": TransactionID, serverSigned1, serverSignature, SM-DP+ (DPauth) Certificate
rnote over LPA
Check returned SM-DP+ Address (contained in serverSigned)
OID in Cert must match OID in AC
Generate ctxParams1 (M-ID, deviceInfo)
end rnote
LPA -> eUICC: Authenticate Server (Transaction-ID, serverSigned1, ctxParams1)
rnote over eUICC
Verify SM-DP+ Certificate against CI
Verify SM-DP+ signed1 & Signature
Generate euiccSigned1 (Trans-ID, serverChallenge, euiccInfo2, ctxParams1)
end rnote
LPA <- - eUICC: eUICCSigned1, eUICC & EUM Certificate
LPA -> "SM-DP+": Authenticate Client (eUICCSigned1, eUICC & EUM Certificate)
rnote over "SM-DP+"
Verify eUICC & EUM Certificate against CI
Verify eUICC signed1 & Signature
Attached TransactionID & Server-Challenge matches
ctxParams1 M-ID matches a PPDO 
PPDO is (not) associated with EID?
PPDO is "released" or "downloaded"
Perform eUICC eligibility check
Build Profile Metadata
smdpSigned2 (TransID, CC Required Flag)
end rnote
LPA <- - "SM-DP+": TransID, Profile Metadata, smdpSigned2, SM-DP+ (DPpb) Certificate

== Profile Download ==

LPA -> LPA: PPR(s) allowed
"End User" -> LPA: Profile Download Consent
"End User" -> LPA: Enter Confirmation Code if required
LPA -> eUICC: PrepareDownload (smdpSigned2, SM-DP+ (DPpb) Certificate, hashed CC)
rnote over eUICC
Verify DPpb Certificate, and if auth and pb have same owner
Verify signature
Generate ECKA one-time keypair
Generate eUICCSigned2 (Trans-ID, otPK-EUICC, HashedCC)
end rnote
LPA <- - eUICC: euiccSigned2, euiccSignature2
LPA -> "SM-DP+": Get Bound Profile Package (euiccSigned2, euiccSignature2)
rnote over "SM-DP+"
Verify Signature & hashed Confirmation Code
Generate ECKA one-time keypair
Generate Session Keys
Generate BPP
Link BPP to EID if not already done
Encrypt BPP with session keys
end rnote
LPA <- - "SM-DP+": Trans-ID, BPP
== Profile Installation ==
LPA -> eUICC : Initialise Secure Channel
rnote over eUICC: Generate Session Keys
LPA -> eUICC : Load Bound Profile Package x N
rnote over eUICC: Rearrange Profile Package, Decrypt with session keys
LPA <- - eUICC : Profile Installation Result
LPA -> "SM-DP+" : Profile Installation Result Notification
@enduml

PlantUML version 1.2022.6beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>